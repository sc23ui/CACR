function Spin2WinWheel(){var u=this,A=document.querySelector(".wheelSVG"),c=document.querySelector(".wheel"),R=document.querySelector(".wheelOutline"),Z=document.querySelector(".wheelContainer"),p=document.querySelector(".peg"),aa=document.querySelector(".pegContainer"),za=document.querySelector(".mainContainer"),B=document.querySelector(".valueContainer"),ba=document.querySelector(".centerCircle"),n=document.querySelector(".toast"),ca=document.querySelector(".toast p"),b,da,ea,S,fa,T,q,ga,ha,ia,
ja,I,t,v,ka,la,ma,na,oa,pa,U,m,x,y,k,qa,J,r=0,e,f,E,g=0,C=2,K=0,F=0,V=F,W=[],ra,sa,X,ta,L,ua,va,z,w=null,M,N,O,Y,G=[],Aa=new Audio("media/wheel_tick.mp3"),d,D=!0,P=null,H=!1,wa=function(){TweenMax.set("svg",{visibility:"visible"});TweenMax.set(c,{svgOrigin:e+" "+f,x:0,y:0});TweenMax.set(p,{x:e-p.getBBox().width/2,y:f-q-p.getBBox().height/2,transformOrigin:"50% 25%",visibility:"visible"});TweenMax.set(aa,{transformOrigin:"50% 100%",scale:T/600});TweenMax.set(za,{svgOrigin:e+" "+f,rotation:-90,x:0,
y:0});TweenMax.set([n],{xPercent:-50,left:"50%"});TweenMax.set("svg",{xPercent:-50,left:"50%"})},Ba=function(){for(var a=0;a<x;a++){var h=document.createElementNS("http://www.w3.org/2000/svg","g");if("image"==m[a].type){var b=document.createElementNS("http://www.w3.org/2000/svg","image");h.appendChild(b);b.setAttribute("class","wheelImage");b.setAttributeNS(null,"x",e-I/2);b.setAttributeNS(null,"y",f-q+ia);b.setAttributeNS(null,"width",I);b.setAttributeNS(null,"height",I);b.setAttributeNS("http://www.w3.org/1999/xlink",
"xlink:href",m[a].value)}else if("string"==m[a].type){var c=document.createElementNS("http://www.w3.org/2000/svg","text"),d,l;m[a].value.split("^").forEach(function(a,b){d=document.createTextNode(a);l=document.createElementNS("http://www.w3.org/2000/svg","tspan");l.setAttributeNS(null,"dy",b?"1.2em":0);l.setAttributeNS(null,"x",e);l.setAttributeNS(null,"text-anchor","middle");l.appendChild(d);c.appendChild(l)});h.appendChild(c);c.setAttribute("class","wheelText");c.setAttributeNS(null,"fill",ga);
c.setAttributeNS(null,"x",e);c.setAttributeNS(null,"y",f-q+ha);c.style.fontSize=ja}B.appendChild(h);TweenMax.set(h,{svgOrigin:e+" "+f,rotation:a*k})}TweenMax.set(B,{svgOrigin:e+" "+f})},Ca=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","g"),b=document.createElementNS("http://www.w3.org/2000/svg","circle");R.appendChild(a);b.setAttributeNS(null,"fill","transparent");b.setAttributeNS(null,"stroke",S);b.setAttributeNS(null,"stroke-width",fa);b.setAttributeNS(null,"cx",e);b.setAttributeNS(null,
"cy",f);b.setAttributeNS(null,"r",q);a.appendChild(b);return a},Da=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"fill",ma);a.setAttributeNS(null,"stroke",ka);a.setAttributeNS(null,"stroke-width",la);a.setAttributeNS(null,"cx",e);a.setAttributeNS(null,"cy",f);a.setAttributeNS(null,"r",oa);return a},Ea=function(){Aa.play()},Fa=function(){n.style.visibility="hidden"},xa=function(){n.style.visibility="hidden";w.onclick=null;C+=2},Ga=function(){disableWheel();
D&&(Y=VelocityTracker.track(c,"rotation"))},Q=function(a){J=r;r=Math.round(c._gsTransform.rotation/k);r!=J&&TweenMax.fromTo(p,.2,{rotation:r>J?-35:35},{onStart:ua?Ea:null,rotation:0,ease:Back.easeOut});TweenMax.set(B,{rotation:c._gsTransform.rotation})},Ha=function(){v=c._gsTransform.rotation;var a=Math.round(v%360),a=0<a?360-a:a,a=0>a?a*=-1:a;if(Y&&.5>=Y.getVelocity("rotation"))enableWheel(),showResult("invalidSpin");else{showResult(Math.abs(Math.round(a/k)));if(D)if(-1<y)g++;else return;else g++,
t[0].vars.snap=[d[g]];VelocityTracker.untrack(c);g>=y?endGame():enableWheel()}},Ia=function(a){return function(b){return Math.round(b/k)*k-a}},ya=function(){t=Draggable.create(c,{type:"rotation",bounds:{minRotation:-1E16,maxRotation:0},throwProps:!0,ease:Back.easeOut.config(.2),snap:D?Ia(0):[d[g]],throwResistance:0,minDuration:ra,onThrowComplete:Ha,onPress:Fa,onDrag:Q,onThrowUpdate:Q,overshootTolerance:1,onDragEnd:Ga})},Ka=function(){H=!0;m.forEach(function(a,b){isNaN(a.probability)&&(H=!1)});H&&
(d=[],y=-1==b.numSpins?1E16:parseInt(b.numSpins),Ja())},Ja=function(){var a=0;m.forEach(function(b,c){a+=b.probability});100==Math.ceil(a)||100==Math.floor(a)?createProbabilityArray():1==confirm("Total probability: "+a+" - If you have set JSON probability values they must add up to 100")&&(TweenMax.set(Z,{autoAlpha:0}),TweenMax.set(Z,{autoAlpha:0}))};createProbabilityArray=function(){P=[];m.forEach(function(a,b){for(var c=0;c<a.probability;c++)P.push(b)})};showProbabilityError=function(){};createClickToSpin=
function(){Ka()&&createProbabilityArray();w?w.onclick=getTrigger():(w=c,c.onclick=getTrigger())};getTrigger=function(){return function(){H?ThrowPropsPlugin.to(c,{throwProps:{rotation:{velocity:Math.floor(201*Math.random()+-700),end:-(k*P[Math.floor(Math.random()*P.length)])-1080*C}},onStart:xa,onUpdate:Q,ease:Back.easeOut.config(.2),overshootTolerance:0,onComplete:spinComplete}):ThrowPropsPlugin.to(c,{throwProps:{rotation:{velocity:Math.floor(201*Math.random()+-700),end:D?-(k*Math.floor(Math.random()*
(x-0+1)+0))-1080*C:[d[g]]}},onStart:xa,onUpdate:Q,ease:Back.easeOut.config(.2),overshootTolerance:0,onComplete:spinComplete})}};spinComplete=function(){v=c._gsTransform.rotation;var a=Math.round(v%360),a=0<a?360-a:a,a=0>a?a*=-1:a;showResult(Math.abs(Math.round(a/k)));if(D)if(-1<y)g++;else return;else g++;g>=y?endGame():w.onclick=getTrigger()};endGame=function(){disableWheel();TweenMax.set(A,{alpha:.3});TweenMax.to(ca,1,{text:sa,ease:Linear.easeNone,delay:2});N({gameId:L,target:u,results:G})};disableWheel=
function(){z||t[0].disable()};enableWheel=function(){z||t[0].enable()};showResult=function(a){z||t[0].applyBounds({minRotation:-1E16,maxRotation:v});"invalidSpin"==a?(TweenMax.set(c,{rotation:d[g]}),showToast(X),a={target:u,type:"error",spinCount:g,win:null,msg:X,gameId:L},O(a),G.push(a)):isNaN(a)||(showToast(m[a].resultText),a={target:u,type:"result",spinCount:g,win:m[a].win,msg:m[a].resultText,gameId:L,userData:m[a].userData},M(a),G.push(a))};showIntroText=function(a){showToast(ta)};showInitError=
function(a){TweenMax.set([A,p],{visibility:"hidden"});alert(a)};showToast=function(a){n.style.visibility="visible";n.style.backgroundColor="#E81D62";ca.innerHTML=a;TweenMax.fromTo(n,.6,{y:20,alpha:0},{y:0,alpha:1,delay:.2,onStart:onresize,ease:Elastic.easeOut.config(.7,.7)})};checkNumSegments=function(){1>=x&&(showInitError("Not enough segments. Please add more entries to segmentValuesArray"),TweenMax.set(A,{visibility:"hidden"}),n.style.backgroundColor="red")};setSpinTrigger=function(){w&&(z=!0);
z&&(w?w.onclick=getTrigger():c.onclick=getTrigger())};M=function(a){u.onResult(a)};O=function(a){u.onError(a)};N=function(a){u.onGameEnd(a)};this.onResult=M;this.onError=O;this.onGameEnd=N;this.getGameProgress=function(){return G};this.init=function(a){if(a){da=a.data.svgWidth;ea=a.data.svgHeight;A.setAttribute("viewBox","0 0 "+da+" "+a.data.svgHeight);b=a.data;N=a.onGameEnd?a.onGameEnd:u.onGameEnd;M=a.onResult?a.onResult:u.onResult;O=a.onError?a.onError:u.onError;w=a.spinTrigger?a.spinTrigger:null;
setSpinTrigger();S=b.wheelStrokeColor;T=b.wheelSize;q=T/2;ga=b.wheelTextColor;S=b.wheelStrokeColor;fa=b.wheelStrokeWidth;ha=b.wheelTextOffsetY;ia=b.wheelImageOffsetY;I=b.wheelImageSize;ja=b.wheelTextSize;ka=b.centerCircleStrokeColor;la=b.centerCircleStrokeWidth;ma=b.centerCircleFillColor;na=b.centerCircleSize;oa=na/2;pa=b.segmentStrokeColor;U=b.segmentStrokeWidth;m=b.segmentValuesArray;x=m.length;y=-1==b.numSpins?1E16:parseInt(b.numSpins);ra=b.minSpinDuration;sa=b.gameOverText;X=b.invalidSpinText;
ta=b.introText;ua=b.hasSound;L=b.gameId;z=b.clickToSpin;k=360/x;qa=k/2;e=b.centerX;f=b.centerY;E=b.colorArray;va=b.hasShadows;d=b.spinDestinationArray;va&&(R.setAttributeNS(null,"filter","url(#shadow)"),B.setAttributeNS(null,"filter","url(#shadow)"),ba.setAttributeNS(null,"filter","url(#shadow)"),aa.setAttributeNS(null,"filter","url(#shadow)"),n.style.boxShadow="0px 0px 20px rgba(21,21,21,0.5)");wa();for(var h,g,t,p,l,v,r=0;r<x;r++)F=-qa,V=F+k,a=e+q*Math.cos(Math.PI*F/180),g=f+q*Math.sin(Math.PI*
F/180),h=e+q*Math.cos(Math.PI*V/180),t=f+q*Math.sin(Math.PI*V/180),p="M"+e+","+f+"  L"+a+","+g+"  A"+q+","+q+" 0 0,1 "+h+","+t+"z",v=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","path"),v.appendChild(l),c.appendChild(v),TweenMax.set(l,{rotation:r*k,svgOrigin:e+" "+f}),l.setAttributeNS(null,"d",p),E[r]?p=E[r]:(p=E[K],K++,K==E.length&&(K=0)),l.setAttributeNS(null,"fill",p),l.setAttributeNS(null,"stroke",0),W.push({path:l,x1:a,x2:h,
y1:g,y2:t});if(0<U)for(a=0;a<x;a++)h=document.createElementNS("http://www.w3.org/2000/svg","line"),h.setAttributeNS(null,"x1",e),h.setAttributeNS(null,"x2",W[a].x2),h.setAttributeNS(null,"y1",f),h.setAttributeNS(null,"y2",W[a].y2),h.setAttributeNS(null,"stroke",pa),h.setAttributeNS(null,"stroke-width",U),c.appendChild(h),TweenMax.set(h,{svgOrigin:e+" "+f,rotation:a*k});Ba();R.appendChild(Ca());ba.appendChild(Da());a:if(0==y)showInitError("numSpins MUST BE GREATER THAN 0");else if(!H){if(0<d.length)for(D=
!1,y=d.length,a=0;a<d.length;a++){if(d[a]>x||0===d[a]){showInitError("Invalid destination set - please ensure the destination in spinDestinationArray is greater than 0 and less than or equal to the number of segments");n.style.backgroundColor="red";break a}--d[a];d[a]=-1*d[a]*k-1080*C;C+=2}z?createClickToSpin():ya();showIntroText()}checkNumSegments()}else wa(),showInitError("PLEASE INCLUDE THE INIT OBJECT")};window.onresize=function(){var a=f-ea/2;parseFloat(getComputedStyle(A).width);var b=parseFloat(getComputedStyle(A).height);
parseFloat(getComputedStyle(n).width);var c=parseFloat(getComputedStyle(n).height);TweenMax.set(".toast",{y:(b+a)/2-c/2})};this.restart=function(){z||(t[0].kill(),r=J=null,TweenMax.to([c,B],.3,{rotation:"0_short",onComplete:ya}));TweenMax.set(A,{alpha:1});TweenMax.to([c,B],.3,{rotation:"0_short"});n.style.visibility="hidden";g=0;C=2;G=[];showIntroText()}};